#!/usr/bin/env bash
INPUT_FILE="../sysroot/include/bits/errno.h"
TMP_FILE="tmp/errno.js"
OUTPUT_FILE="src/syscall/linux/errno.js"

{
  cat "${INPUT_FILE}"
  echo "// This file is autogenerated by tools/generateErrnoJS"
  echo "const E = {"
  sed -E 's/#define E(\w+)\s+(\w+)/  \1: E\1,/g;s/\b2BIG\b/TOOBIG/g' "${INPUT_FILE}"
  echo "};"
  echo
  echo "// TODO: maybe make a class LinuxSyscallErrnoError for errors to inherit from"
  echo
  echo "export {E};"
} >${TMP_FILE}

clang -C -E -P -nostdinc -undef -x c -o "${OUTPUT_FILE}" "${TMP_FILE}"
